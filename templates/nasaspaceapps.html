<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Air Pollution Analysis â€” Professional Interface</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --bg1: #0f172a;
  --glass: rgba(255,255,255,0.06);
  --glass-2: rgba(255,255,255,0.08);
  --accent1: #1a2a6c;
  --accent2: #b21f1f;
  --accent3: #fdbb2d;
  --card-radius: 16px;
  --muted: rgba(255,255,255,0.75);
  --glass-border: rgba(255,255,255,0.06);
}
* { box-sizing: border-box; margin:0; padding:0; }
html, body { height: 100%; font-family:'Inter', sans-serif; background: linear-gradient(135deg,var(--accent1),var(--accent2) 50%,var(--accent3)); color:#eef2ff; }
body { display:flex; flex-direction:column; min-height:100vh; padding:28px; gap:18px; }

header {
  max-width:1200px; margin:0 auto; display:flex; align-items:center; gap:16px;
  padding:20px 24px; border-radius:var(--card-radius);
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  box-shadow:0 8px 30px rgba(2,6,23,0.35); border:1px solid rgba(255,255,255,0.04);
  width:100%;
}
header h1 { font-size:1.25rem; font-weight:700; letter-spacing:0.2px; }
header p { font-size:0.92rem; opacity:0.85; color:rgba(255,255,255,0.9); }

.stage {
  max-width:1200px; margin:0 auto;
  display:grid; grid-template-columns: 360px 1fr; gap:22px; align-items:start;
  width:100%;
}

/* LEFT COLUMN: GAUGE + BUTTON */
.left-column { display:flex; flex-direction:column; gap:20px; }

.gauge-card {
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  padding:18px; border-radius: var(--card-radius);
  min-height:360px; border:1px solid var(--glass-border);
  display:flex; flex-direction:column; gap:12px; justify-content:center; align-items:center;
  position:relative; overflow:visible;
}
.gauge-title { font-weight:700; font-size:1.05rem; color:#fff; }
.gauge-sub { font-size:0.85rem; opacity:0.85; color:rgba(255,255,255,0.9); }
.gauge-wrap { width:320px; height:200px; display:flex; justify-content:center; align-items:center; position:relative; }
svg.gauge { width:320px; height:200px; overflow:visible; display:block; }
.needle { transform-origin: 160px 160px; transition: transform 1.2s cubic-bezier(.2,.9,.2,1); will-change: transform; }

/* --- ðŸ’¡ FIX 1: CENTER DOT POSITION --- */
/* Moved down to align with the needle's pivot point (y=160 in the 200px SVG) */
.center-dot {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 40px; /* Was 56px. 200px (height) - 160px (pivot) = 40px */
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: linear-gradient(180deg, #fff, #ddd);
    box-shadow: 0 4px 12px rgba(0,0,0,0.45);
    border: 2px solid rgba(255,255,255,0.18);
}

.gauge-value { margin-top:6px; font-weight:800; font-size:1.6rem; color:#fff; display:flex; gap:8px; align-items:baseline; }
.gauge-unit { font-size:0.85rem; font-weight:600; opacity:0.85; }
.sensor-status { font-size:0.78rem; color:#e6edf7; }

/* BUTTON */
.calc-btn {
  background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
  border:1px solid rgba(255,255,255,0.12); padding:18px 28px; border-radius:14px;
  display:flex; gap:12px; align-items:center; cursor:pointer;
  box-shadow:0 10px 30px rgba(2,6,23,0.35); transition: transform .18s ease, box-shadow .18s ease;
  backdrop-filter: blur(6px) saturate(120%); justify-content:flex-start;
}
.calc-btn:hover { transform:translateY(-4px); box-shadow:0 18px 40px rgba(2,6,23,0.45); }
.calc-btn:active { transform:translateY(-1px); }
.calc-btn .icon { background: linear-gradient(90deg,var(--accent1),var(--accent2)); padding:12px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center; color:#fff; font-size:1.05rem; box-shadow:0 6px 18px rgba(0,0,0,0.3); }
.calc-btn .text { display:flex; flex-direction:column; align-items:flex-start; }
.calc-btn .title { font-weight:700; font-size:1.02rem; color:#fff; }
.calc-btn .desc { font-size:0.85rem; opacity:0.9; color:rgba(255,255,255,0.95); }

/* RIGHT info card */
.info-card {
  min-height:600px; background:#ffffff; color:#0b1220; border-radius: var(--card-radius); padding:20px;
  display:flex; flex-direction:column; gap:14px; box-shadow:0 10px 30px rgba(2,6,23,0.18); border:1px solid rgba(2,6,23,0.06);
}
.info-empty { border:2px dashed rgba(12,20,30,0.06); border-radius:10px; padding:22px; display:flex; flex-direction:column; gap:8px; align-items:flex-start; }
.info-empty h2 { font-size:1.05rem; color:#091024; }
.info-empty p { font-size:0.92rem; color:#3b4752; opacity:0.95; }

footer { max-width:1200px; margin:0 auto; color:rgba(255,255,255,0.85); font-size:0.9rem; display:flex; justify-content:space-between; width:100%;}
footer a { color:inherit; text-decoration:none; opacity:0.9; }

@media(max-width:980px){
  .stage { grid-template-columns:1fr; }
}

/* --- ðŸ’¡ GÃ–STERGE ANÄ°MASYONLARI --- */
#needle {
    transform: rotate(var(--rotation-deg, -90deg));
    /* Harika bir "yaylanma" efekti iÃ§in Ã¶zel animasyon eÄŸrisi */
    transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

#calculateBtn {
    cursor: pointer; /* Butonun tÄ±klanabilir olduÄŸunu belirtir */
    transition: background-color 0.3s, transform 0.2s;
}

#calculateBtn:disabled {
    cursor: wait; /* Bekleme durumunda imleci deÄŸiÅŸtirir */
    background-color: #5a67d8; /* Butonun rengini hafifÃ§e deÄŸiÅŸtirir */
}

#calculateBtn:hover:not(:disabled) {
    transform: translateY(-2px); /* Butonun Ã¼zerine gelince hafifÃ§e yukarÄ± kalkar */
}

/* --- ðŸ’¡ BÄ°LGÄ° KARTI ANÄ°MASYONLARI VE STÄ°LLERÄ° --- */
#infoContent {
    opacity: 0; /* BaÅŸlangÄ±Ã§ta gÃ¶rÃ¼nmez */
    transform: translateY(10px); /* HafifÃ§e aÅŸaÄŸÄ±da baÅŸlar */
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
}

#infoContent.info-visible {
    opacity: 1; /* GÃ¶rÃ¼nÃ¼r hale gelir */
    transform: translateY(0); /* Normal pozisyonuna dÃ¶ner */
}

.card-section {
    padding-bottom: 12px;
    margin-bottom: 12px;
    border-bottom: 1px solid #e0e0e0;
}
.card-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}
.card-title { font-size: 1.25rem; color: #111; margin: 0 0 4px; text-align: center; }
.card-category { font-size: 1.1rem; font-weight: 700; text-align: center; margin: 0; }
.card-subtitle { font-size: 1rem; color: #333; margin: 0 0 8px; display: flex; align-items: center; gap: 8px; }
.card-text { font-size: 0.9rem; color: #444; line-height: 1.5; margin: 0; }

.advisory {
    background-color: color-mix(in srgb, var(--advisory-color, #888) 15%, #fff);
    padding: 14px;
    border-radius: 8px;
    border-left: 4px solid var(--advisory-color, #888);
}

.pollutant-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 4px;
    border-bottom: 1px solid #eee;
    transition: background-color 0.3s;
}
.pollutant-row:last-child {
    border-bottom: none;
}
.pollutant-name { font-weight: 600; text-transform: uppercase; font-size: 0.9rem; }
.pollutant-value { font-size: 0.9rem; }

/* --- ðŸ’¡ DOMÄ°NANT KÄ°RLETÄ°CÄ° VURGUSU --- */
.pollutant-row.dominant {
    background-color: #f0f4ff;
    font-weight: 700;
}

/* --- ðŸ’¡ UYARI SÄ°STEMÄ° --- */
.alert-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
}

.alert {
    background: #ef4444;
    color: white;
    padding: 16px 20px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    gap: 12px;
    opacity: 0;
    transform: translateX(50px);
    transition: opacity 0.4s, transform 0.4s;
    max-width: 400px;
}

.alert.show {
    opacity: 1;
    transform: translateX(0);
}

.alert-icon {
    font-size: 1.2rem;
    flex-shrink: 0;
}

.alert-content {
    flex: 1;
}

.alert-title {
    font-weight: 700;
    margin-bottom: 4px;
}

.alert-message {
    font-size: 0.9rem;
    opacity: 0.9;
}

.alert-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.1rem;
    cursor: pointer;
    opacity: 0.8;
    transition: opacity 0.2s;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.alert-close:hover {
    opacity: 1;
}

/* --- ðŸ’¡ GEÃ‡MÄ°Åž UYARILAR PANELÄ° --- */
.history-panel {
    background: #ffffff;
    border-radius: var(--card-radius);
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.history-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #111;
}

.history-clear {
    background: #f0f0f0;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: background 0.2s;
}

.history-clear:hover {
    background: #e0e0e0;
}

.history-list {
    max-height: 200px;
    overflow-y: auto;
}

.history-item {
    padding: 10px 0;
    border-bottom: 1px solid #eee;
    font-size: 0.9rem;
}

.history-item:last-child {
    border-bottom: none;
}

.history-time {
    color: #666;
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.history-message {
    color: #333;
}

.no-history {
    text-align: center;
    color: #888;
    padding: 20px 0;
    font-style: italic;
}

/* --- ðŸ’¡ KONTROL PANELÄ° --- */
.control-panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    padding: 18px;
    border-radius: var(--card-radius);
    border: 1px solid var(--glass-border);
    margin-top: 20px;
}

.control-title {
    font-weight: 700;
    font-size: 1.05rem;
    color: #fff;
    margin-bottom: 12px;
}

.control-options {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

.control-option {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
}

.control-option input[type="checkbox"] {
    width: 16px;
    height: 16px;
}

</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:14px">
    <div style="width:46px;height:46px;border-radius:10px;background:linear-gradient(180deg,#fff,#f0f0f0);display:flex;align-items:center;justify-content:center;color:var(--accent1);font-weight:800;box-shadow:0 6px 18px rgba(0,0,0,0.18)">AQ</div>
  </div>
  <div style="flex:1">
    <h1>Air Pollution Analysis and Recommendation System</h1>
    <p>Realistic preview â€” click the button to start measurement.</p>
  </div>
</header>

<main class="stage">
  <div class="left-column">
    <section class="gauge-card">
      <div style="text-align:left;width:100%">
        <div class="gauge-title">Air Quality Meter</div>
        <div class="gauge-sub">Device: Mobile Air Sensor â€¢ Simulation</div>
      </div>
      <div class="gauge-wrap">
        <svg class="gauge" viewBox="0 0 320 200">
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0%" stop-color="#4ade80"/>
              <stop offset="20%" stop-color="#86efac"/>
              <stop offset="40%" stop-color="#facc15"/>
              <stop offset="60%" stop-color="#fb923c"/>
              <stop offset="85%" stop-color="#f97373"/>
              <stop offset="100%" stop-color="#ef4444"/>
            </linearGradient>
            <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
              <feDropShadow dx="0" dy="6" stdDeviation="8" flood-color="#000" flood-opacity="0.25"/>
            </filter>
          </defs>
          <g>
            <path d="M 24 160 A 136 136 0 0 1 296 160" fill="none" stroke="url(#g1)" stroke-width="18" stroke-linecap="round" filter="url(#shadow)"></path>
          </g>
          <g class="needle" id="needle" style="--rotation-deg: -90deg;">
            <line x1="160" y1="160" x2="160" y2="46" stroke="#00121a" stroke-width="4" stroke-linecap="round"/>
            <line x1="160" y1="160" x2="160" y2="50" stroke="rgba(255,255,255,0.92)" stroke-width="2" stroke-linecap="round"/>
          </g>
          <g>
            <text x="18" y="155" font-size="11" fill="#ffffff" opacity="0.75" text-anchor="middle">0</text>
            <text x="75" y="80" font-size="11" fill="#ffffff" opacity="0.75" text-anchor="middle">50</text>
            <text x="160" y="52" font-size="11" fill="#ffffff" opacity="0.75" text-anchor="middle">100</text>
            <text x="245" y="80" font-size="11" fill="#ffffff" opacity="0.75" text-anchor="middle">200</text>
            <text x="302" y="155" font-size="11" fill="#ffffff" opacity="0.75" text-anchor="middle">500</text>
          </g>
        </svg>
        <div class="center-dot"></div>
      </div>
      <div style="width:100%;display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div class="gauge-value" id="gaugeNumeric">0 <span class="gauge-unit">AQI</span></div>
          <div class="small-muted" id="gaugeCategory">Waiting...</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:0.82rem;font-weight:700;margin-bottom:6px">Sensor Status</div>
          <div class="sensor-status">Connected (simulation)</div>
        </div>
      </div>
    </section>

    <button id="calculateBtn" class="calc-btn">
      <div class="icon"><i class="fas fa-bolt"></i></div>
      <div class="text">
        <div class="title">Calculate Air Pollution</div>
        <div class="desc">Click to start measurement</div>
      </div>
    </button>
    
    <div class="control-panel">
      <div class="control-title">Alert Settings</div>
      <div class="control-options">
        <label class="control-option">
          <input type="checkbox" id="soundAlerts" checked>
          Sound Alerts
        </label>
        <label class="control-option">
          <input type="checkbox" id="browserNotifications" checked>
          Browser Notifications
        </label>
        <label class="control-option">
          <input type="checkbox" id="autoRefresh" checked>
          Auto Refresh (30s)
        </label>
      </div>
    </div>
  </div>

  <aside class="info-card" style="grid-column: 2 / -1;">
    <div id="infoContent" class="info-empty">
      <h2>Air Pollution Analysis Results</h2>
      <p>No measurement has been taken yet. Click the "Calculate Air Pollution" button; detailed analysis results, statistics, and protective recommendations will appear here once the measurement is completed.</p>
    </div>
    
    <div class="history-panel">
      <div class="history-header">
        <div class="history-title">Alert History</div>
        <button class="history-clear" id="clearHistory">Clear History</button>
      </div>
      <div class="history-list" id="historyList">
        <div class="no-history">No alerts recorded yet</div>
      </div>
    </div>
  </aside>
</main>

<footer style="margin-top:auto;margin:auto ">
  <div>Â© 2025 Air Pollution Analysis</div>
  <div style="opacity:0.9" class="small-muted"></div>
</footer>

<div class="alert-container" id="alertContainer"></div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- ðŸ’¡ 1: KONFÄ°GÃœRASYON MERKEZÄ° ---
    const AQI_LEVELS = [
        { limit: 50, category: "Good", color: "#4ade80", description: "Air quality is satisfactory; pollution poses little or no risk.", advisory: "No risk for the general population." },
        { limit: 100, category: "Moderate", color: "#facc15", description: "Acceptable air quality; minor concern for a small number of sensitive people.", advisory: "Unusually sensitive individuals should consider limiting outdoor activities." },
        { limit: 150, category: "Unhealthy for Sensitive Groups", color: "#fb923c", description: "Sensitive groups may experience health effects.", advisory: "Children, elderly, and people with heart/lung diseases may be affected." },
        { limit: 200, category: "Unhealthy", color: "#f87171", description: "General public may begin to be affected.", advisory: "More serious effects for sensitive groups." },
        { limit: 300, category: "Very Unhealthy", color: "#a855f7", description: "Health alert: emergency conditions.", advisory: "Increased likelihood of effects for everyone." },
        { limit: 501, category: "Hazardous", color: "#b91c1c", description: "Emergency health warnings.", advisory: "Entire population is at high risk; outdoor activities should be avoided." }
    ];

    // UyarÄ± eÅŸikleri
    const ALERT_THRESHOLD = 200;
    const POLLUTANTS = ["PM2.5", "PM10", "NO2", "O3"];
    const ALERT_SOUND_URL = "https://assets.mixkit.co/active_storage/sfx/286/286-preview.mp3";

    // --- HTML Elementleri ---
    const calculateBtn = document.getElementById('calculateBtn');
    const needle = document.getElementById('needle');
    const gaugeNumeric = document.getElementById('gaugeNumeric');
    const gaugeCategory = document.getElementById('gaugeCategory');
    const infoContent = document.getElementById('infoContent');
    const btnTitle = calculateBtn.querySelector('.title');
    const btnDesc = calculateBtn.querySelector('.desc');
    const alertContainer = document.getElementById('alertContainer');
    const historyList = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistory');
    
    // Kontroller
    const soundAlerts = document.getElementById('soundAlerts');
    const browserNotifications = document.getElementById('browserNotifications');
    const autoRefresh = document.getElementById('autoRefresh');

    // Otomatik yenileme zamanlayÄ±cÄ±sÄ±
    let autoRefreshInterval = null;

    /**
     * Sahte bir sensÃ¶rden asenkron olarak veri alÄ±r.
     * @returns {Promise<object>} Hava kalitesi verilerini iÃ§eren bir Promise.
     */
    async function getSensorData() {
        // GerÃ§ek bir API Ã§aÄŸrÄ±sÄ±nÄ± simÃ¼le etmek iÃ§in bekleme sÃ¼resi
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Daha gerÃ§ekÃ§i veri daÄŸÄ±lÄ±mÄ± iÃ§in rastgele AQI
        // Daha yÃ¼ksek AQI deÄŸerlerinin daha az olasÄ± olmasÄ± iÃ§in
        const randomValue = Math.random();
        let aqi;
        
        if (randomValue < 0.6) {
            // %60 ihtimalle iyi/orta AQI (0-100)
            aqi = Math.floor(Math.random() * 100);
        } else if (randomValue < 0.85) {
            // %25 ihtimalle hassas gruplar iÃ§in saÄŸlÄ±ksÄ±z (100-150)
            aqi = Math.floor(Math.random() * 50) + 100;
        } else if (randomValue < 0.95) {
            // %10 ihtimalle saÄŸlÄ±ksÄ±z (150-200)
            aqi = Math.floor(Math.random() * 50) + 150;
        } else {
            // %5 ihtimalle Ã§ok saÄŸlÄ±ksÄ±z/tehlikeli (200-500)
            aqi = Math.floor(Math.random() * 300) + 200;
        }
        
        // SimÃ¼le edilmiÅŸ kirletici verileri
        const data = {
            aqi: aqi,
            dominant_pollutant: "pm25",
            pollutants: {
                pm25: { value: (aqi * 0.55).toFixed(1), unit: "Âµg/mÂ³" },
                pm10: { value: (aqi * 0.75).toFixed(1), unit: "Âµg/mÂ³" },
                o3: { value: (aqi * 0.0005).toFixed(3), unit: "ppm" },
                no2: { value: (aqi * 0.0003).toFixed(3), unit: "ppm" },
            }
        };
        return data;
    }

    /**
     * AQI deÄŸerine gÃ¶re ilgili kategori bilgilerini bulur.
     * @param {number} aqi - Hava Kalitesi Ä°ndeksi deÄŸeri.
     * @returns {object} Kategori, renk ve aÃ§Ä±klama bilgilerini iÃ§eren nesne.
     */
    function getAqiInfo(aqi) {
        return AQI_LEVELS.find(level => aqi <= level.limit) || AQI_LEVELS[AQI_LEVELS.length - 1];
    }
    
    /**
     * Bir deÄŸeri baÅŸlangÄ±Ã§tan bitiÅŸe doÄŸru akÄ±cÄ± bir animasyonla gÃ¼nceller.
     * @param {HTMLElement} element - SayÄ±nÄ±n gÃ¶sterileceÄŸi element.
     * @param {number} endValue - Hedef deÄŸer.
     * @param {number} duration - Animasyon sÃ¼resi (ms).
     */
    function animateValue(element, endValue, duration = 1000) {
        let startTimestamp = null;
        // mevcut deÄŸeri temiz metin olarak al (iÃ§erikte birim olabilir)
        const currentText = element.textContent || '';
        const startValue = parseInt(currentText.replace(/[^0-9\-]/g, '')) || 0;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const currentValue = Math.floor(progress * (endValue - startValue) + startValue);
            element.innerHTML = `${currentValue} <span class="gauge-unit">AQI</span>`;
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    /**
     * GÃ¶sterge ibresinin dÃ¶nÃ¼ÅŸÃ¼nÃ¼ ve renklerini akÄ±cÄ± animasyonlar iÃ§in CSS'e devreder.
     * @param {number} aqi - Hava Kalitesi Ä°ndeksi deÄŸeri.
     */
    function updateGauge(aqi) {
        const aqiClamped = Math.min(Math.max(aqi, 0), 500);
        let rotation;

        // DoÄŸrusal olmayan Ã¶lÃ§ek (0-100 arasÄ± ilk yarÄ±, 100-500 arasÄ± ikinci yarÄ±)
        if (aqiClamped <= 100) {
            rotation = (aqiClamped / 100) * 90 - 90; // -90..0
        } else {
            rotation = ((aqiClamped - 100) / 400) * 90; // 0..90
        }

        needle.style.setProperty('--rotation-deg', `${rotation}deg`);
        animateValue(gaugeNumeric, aqi);
        
        const aqiInfo = getAqiInfo(aqi);
        gaugeCategory.textContent = aqiInfo.category;
        gaugeCategory.style.color = aqiInfo.color;
    }

    /**
     * Bilgi kartÄ±nÄ± oluÅŸturur ve dominant kirleticiyi vurgular.
     * @param {object} data - SensÃ¶rden gelen tÃ¼m veriler.
     */
    function updateInfoCard(data) {
        const aqiInfo = getAqiInfo(data.aqi);

        const pollutantHTML = Object.entries(data.pollutants).map(([key, value]) => {
            const isDominant = key === data.dominant_pollutant;
            return `
                <div class="pollutant-row ${isDominant ? 'dominant' : ''}">
                    <span class="pollutant-name">${key.toUpperCase()} ${isDominant ? ' (Dominant)' : ''}</span>
                    <span class="pollutant-value">${value.value} ${value.unit}</span>
                </div>
            `;
        }).join('');

        infoContent.innerHTML = `
            <div class="card-section">
                <h2 class="card-title">Analysis Results</h2>
                <p class="card-category" style="color:${aqiInfo.color};">${aqiInfo.category}</p>
            </div>
            <div class="card-section">
                <h3 class="card-subtitle"><i class="fas fa-info-circle"></i>Air Quality Description</h3>
                <p class="card-text">${aqiInfo.description}</p>
            </div>
            <div class="card-section advisory" style="--advisory-color: ${aqiInfo.color};">
                <h3 class="card-subtitle"><i class="fas fa-shield-alt"></i>Health Advisory</h3>
                <p class="card-text">${aqiInfo.advisory}</p>
            </div>
            <div class="card-section">
                <h3 class="card-subtitle"><i class="fas fa-smog"></i>Pollutant Details</h3>
                ${pollutantHTML}
            </div>
        `;
        
        // KartÄ±n iÃ§eriÄŸi dolduktan sonra gÃ¶rÃ¼nÃ¼r hale getiriyoruz
        infoContent.classList.remove('info-empty');
        infoContent.classList.add('info-visible');
    }
    
    /**
     * UyarÄ± mesajÄ±nÄ± kaydeder.
     * @param {string} message - Kaydedilecek uyarÄ± mesajÄ±.
     */
    function logAlertMessage(message) {
        let alerts = JSON.parse(localStorage.getItem("alertMessages") || "[]");
        alerts.push({
            message: message,
            timestamp: new Date().toISOString()
        });
        
        // Son 50 uyarÄ±yÄ± sakla
        if (alerts.length > 50) {
            alerts = alerts.slice(-50);
        }
        
        localStorage.setItem("alertMessages", JSON.stringify(alerts));
        updateHistoryDisplay();
    }

    /**
     * UyarÄ± geÃ§miÅŸini gÃ¶rÃ¼ntÃ¼ler.
     */
    function updateHistoryDisplay() {
        const alerts = JSON.parse(localStorage.getItem("alertMessages") || "[]");
        
        if (alerts.length === 0) {
            historyList.innerHTML = '<div class="no-history">No alerts recorded yet</div>';
            return;
        }
        
        historyList.innerHTML = alerts.map(alert => `
            <div class="history-item">
                <div class="history-time">${new Date(alert.timestamp).toLocaleString()}</div>
                <div class="history-message">${alert.message}</div>
            </div>
        `).join('');
        
        // En yeni uyarÄ±lar Ã¼stte gÃ¶rÃ¼nsÃ¼n
        historyList.scrollTop = 0;
    }

    /**
     * UyarÄ± gÃ¶sterir.
     * @param {string} message - GÃ¶sterilecek uyarÄ± mesajÄ±.
     */
    function showAlert(message) {
        const alert = document.createElement('div');
        alert.className = 'alert';
        alert.innerHTML = `
            <div class="alert-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="alert-content">
                <div class="alert-title">Air Quality Alert</div>
                <div class="alert-message">${message}</div>
            </div>
            <button class="alert-close">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        alertContainer.appendChild(alert);
        
        // Animasyon iÃ§in kÄ±sa gecikme
        setTimeout(() => {
            alert.classList.add('show');
        }, 10);
        
        // Kapatma iÅŸlevi
        const closeBtn = alert.querySelector('.alert-close');
        closeBtn.addEventListener('click', () => {
            alert.classList.remove('show');
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 400);
        });
        
        // Otomatik kapatma
        setTimeout(() => {
            if (alert.classList.contains('show')) {
                alert.classList.remove('show');
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 400);
            }
        }, 7000);
        
        // Ses uyarÄ±sÄ±
        if (soundAlerts.checked) {
            const audio = new Audio(ALERT_SOUND_URL);
            audio.play().catch(() => {
                console.log("Autoplay blocked");
            });
        }
        
        // TarayÄ±cÄ± bildirimi
        if (browserNotifications.checked && Notification.permission === "granted") {
            new Notification("Air Quality Alert", {
                body: message,
                icon: "https://cdn-icons-png.flaticon.com/512/564/564619.png"
            });
        }
    }

    /**
     * ArayÃ¼zÃ¼ bir sonraki Ã¶lÃ§Ã¼m iÃ§in sÄ±fÄ±rlar.
     */
    function resetUI() {
        needle.style.setProperty('--rotation-deg', '-90deg');
        gaugeNumeric.innerHTML = `0 <span class="gauge-unit">AQI</span>`;
        gaugeCategory.textContent = "Waiting...";
        gaugeCategory.style.color = "#888";
        infoContent.classList.remove('info-visible');
    }

    /**
     * Otomatik yenilemeyi baÅŸlatÄ±r veya durdurur.
     */
    function toggleAutoRefresh() {
        if (autoRefresh.checked) {
            if (!autoRefreshInterval) {
                autoRefreshInterval = setInterval(simulateMeasurement, 30000);
            }
        } else {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }
    }

    /**
     * Ã–lÃ§Ã¼m simÃ¼lasyonunu Ã§alÄ±ÅŸtÄ±rÄ±r.
     */
    async function simulateMeasurement() {
        // Buton durumunu ayarla
        btnTitle.textContent = "Measuring...";
        btnDesc.textContent = "Please wait, fetching sensor data.";
        calculateBtn.disabled = true;
        
        // Bir Ã¶nceki sonuÃ§larÄ± temizle ve animasyonlu geÃ§iÅŸ saÄŸla
        infoContent.classList.remove('info-visible');
        await new Promise(resolve => setTimeout(resolve, 300));

        try {
            const data = await getSensorData();
            updateGauge(data.aqi);
            updateInfoCard(data);
            
            // UyarÄ± kontrolÃ¼
            if (data.aqi >= ALERT_THRESHOLD) {
                const pollutantName = (data.dominant_pollutant || '').toUpperCase();
                const msg = `Danger! AQI ${data.aqi} detected! Dominant pollutant: ${pollutantName}`;
                showAlert(msg);
                logAlertMessage(msg);
            }
        } catch (error) {
            console.error("An error occurred while fetching data:", error);
            infoContent.innerHTML = `<div class="card-section error"><h2>Error</h2><p>Could not fetch data from the sensor. Please try again later.</p></div>`;
            infoContent.classList.add('info-visible');
        } finally {
            // Butonu tekrar aktif hale getir
            btnTitle.textContent = "Calculate Air Pollution";
            btnDesc.textContent = "Click to start a new measurement";
            calculateBtn.disabled = false;
        }
    }

    // --- Olay Dinleyiciler ---
    calculateBtn.addEventListener('click', simulateMeasurement);
    
    clearHistoryBtn.addEventListener('click', () => {
        localStorage.removeItem("alertMessages");
        updateHistoryDisplay();
    });
    
    autoRefresh.addEventListener('change', toggleAutoRefresh);

    // --- Ä°lk YÃ¼kleme ---
    updateHistoryDisplay();
    
    // Bildirim izni iste
    if (Notification.permission !== "granted" && Notification.permission !== "denied") {
        Notification.requestPermission();
    }
    
    // Otomatik yenilemeyi baÅŸlat
    toggleAutoRefresh();
});
</script>
</body>
</html>
